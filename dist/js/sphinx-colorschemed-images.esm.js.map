{"version":3,"file":"sphinx-colorschemed-images.esm.js","sources":["../../js/src/main.js"],"sourcesContent":["export class SphinxColorschemeImageHandler {\n  constructor(options={}) {\n    this._schemes = [];\n    this._mediaqs = [];\n\n    // If options are not given or if it is given with a key 'auto'\n    // and a boolean value true, then the instance created will add\n    // an event listener for changes on prefers-color-scheme to\n    // update images accordingly.\n    this._auto = options.hasOwnProperty('auto')\n      ? options['auto'] === true\n      : true;\n\n    const meta_prop = document.querySelector('meta[name=\"color-scheme\"]');\n    let meta_schemes = (meta_prop == undefined) ? \"\" : meta_prop.content;\n\n    if (meta_schemes.length > 0) {\n      const schemes = meta_schemes.split(\" \");\n      for (const item of schemes) {\n        this._schemes.push(item.trim());\n      }\n    } else {\n      this._schemes = ['light', 'dark'];\n    }\n\n    for (const scheme of this._schemes) {\n      const q = globalThis.matchMedia(`(prefers-color-scheme: ${scheme})`);\n      if (q.matches) {\n        this.activate(scheme);\n      }\n      if (this._auto === true) {\n        q.addEventListener('change', e => {\n          if (e.matches) {\n            this.activate(scheme);\n          }\n        });\n        this._mediaqs.push(q);\n      }\n    }\n  }\n\n  activate = (scheme) => {\n    const data_att = `data-alt-src-color-scheme-${scheme}`;\n    const images = document.querySelectorAll(`img[${data_att}]`);\n    for (const img of images) {\n      const new_img = new Image();\n      const new_src = img.getAttribute(data_att);\n      new_img.src = new_src;\n      new_img.addEventListener('load', () => {\n        img.src = new_img.src;\n      });\n      new_img.addEventListener('error', () => {\n        console.error(`Could not replace image ${img.src} with ${new_src}.`);\n      });\n      if (new_img.complete) {\n        img.src = new_img.src;\n      }\n\n      // Check whether the image is inside a <figure>.\n      const figure = img.closest('figure');\n      if (figure != undefined) {\n        const anchor = figure.querySelector('a');\n        if (anchor.getAttribute('href') !== new_src) {\n          anchor.href = new_src;\n        }\n      } else if (\n        (img.parentElement.tagName == \"A\")\n        && img.parentElement.getAttribute(\"href\") !== new_src\n      ) {\n        const parent = img.parentElement;\n        parent.href = img.getAttribute(data_att);\n        console.log(\"the new anchor's href:\", parent.href);\n      }\n    }\n  }\n}\n"],"names":["SphinxColorschemeImageHandler","options","_this","activate","scheme","data_att","images","document","querySelectorAll","_loop","img","_step","value","new_img","Image","new_src","getAttribute","src","addEventListener","console","error","complete","figure","closest","undefined","anchor","querySelector","href","parentElement","tagName","parent","log","_iterator","_createForOfIteratorHelperLoose","done","_schemes","_mediaqs","_auto","hasOwnProperty","meta_prop","meta_schemes","content","length","schemes","split","_iterator2","_step2","item","push","trim","_loop2","_step3","q","globalThis","matchMedia","matches","e","_iterator3"],"mappings":"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"}