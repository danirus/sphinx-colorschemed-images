{"version":3,"file":"sphinx-colorschemed-images.js","sources":["../../js/src/main.js","../../js/src/script.js"],"sourcesContent":["export class SphinxColorschemeImageHandler {\n  constructor(options={}) {\n    this._schemes = [];\n    this._mediaqs = [];\n\n    // If options are not given or if it is given with a key 'auto'\n    // and a boolean value true, then the instance created will add\n    // an event listener for changes on prefers-color-scheme to\n    // update images accordingly.\n    this._auto = options.hasOwnProperty('auto')\n      ? options['auto'] === true\n      : true;\n\n    const meta_prop = document.querySelector('meta[name=\"color-scheme\"]');\n    let meta_schemes = (meta_prop == undefined) ? \"\" : meta_prop.content;\n\n    if (meta_schemes.length > 0) {\n      const schemes = meta_schemes.split(\" \");\n      for (const item of schemes) {\n        this._schemes.push(item.trim());\n      }\n    } else {\n      this._schemes = ['light', 'dark'];\n    }\n\n    for (const scheme of this._schemes) {\n      const q = globalThis.matchMedia(`(prefers-color-scheme: ${scheme})`);\n      if (q.matches) {\n        this.activate(scheme);\n      }\n      if (this._auto === true) {\n        q.addEventListener('change', e => {\n          if (e.matches) {\n            console.log('event:', e);\n            this.activate(scheme);\n          }\n        });\n        this._mediaqs.push(q);\n      }\n    }\n  }\n\n  activate = (scheme) => {\n    const data_att = `data-alt-src-color-scheme-${scheme}`;\n    const images = document.querySelectorAll(`img[${data_att}]`);\n    for (const img of images) {\n      const new_img = new Image();\n      const new_src = img.getAttribute(data_att);\n      new_img.src = new_src;\n      new_img.addEventListener('load', () => {\n        img.src = new_img.src;\n      });\n      new_img.addEventListener('error', () => {\n        console.error(`Could not replace image ${img.src} with ${new_src}.`);\n      });\n      if (new_img.complete) {\n        img.src = new_img.src;\n      }\n    }\n  }\n}\n","import { SphinxColorschemeImageHandler } from \"./main\";\n\nfunction runWhenDOMContentLoaded(cb) {\n  if (document.readyState != 'loading') {\n    cb();\n  } else if (document.addEventListener) {\n    document.addEventListener('DOMContentLoaded', cb);\n  } else {\n    document.attachEvent('onreadystatechange', function() {\n      if (document.readyState == 'complete') cb();\n    });\n  }\n}\n\nfunction addSphinxColorschemedImageHandler() {\n  return new SphinxColorschemeImageHandler();\n}\n\nrunWhenDOMContentLoaded(addSphinxColorschemedImageHandler);\n"],"names":["SphinxColorschemeImageHandler","options","_this","activate","scheme","data_att","images","document","querySelectorAll","_loop","img","_step","value","new_img","Image","new_src","getAttribute","src","addEventListener","console","error","complete","_iterator","_createForOfIteratorHelperLoose","done","_schemes","_mediaqs","_auto","hasOwnProperty","meta_prop","querySelector","meta_schemes","undefined","content","length","schemes","split","_iterator2","_step2","item","push","trim","_loop2","_step3","q","globalThis","matchMedia","matches","e","log","_iterator3","runWhenDOMContentLoaded","cb","readyState","attachEvent","addSphinxColorschemedImageHandler"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA,IAAaA,6BAA6B,GACxC,SAAAA,6BAAAA,CAAYC,OAAO,EAAK;EAAA,EAAA,IAAAC,KAAA,GAAA,IAAA;EAAA,EAAA,IAAZD,OAAO,KAAA,KAAA,CAAA,EAAA;MAAPA,OAAO,GAAC,EAAE;EAAA;EAAA,EAAA,IAAA,CAyCtBE,QAAQ,GAAG,UAACC,MAAM,EAAK;MACrB,IAAMC,QAAQ,kCAAgCD,MAAQ;MACtD,IAAME,MAAM,GAAGC,QAAQ,CAACC,gBAAgB,CAAQH,MAAAA,GAAAA,QAAQ,MAAG,CAAC;MAAC,IAAAI,KAAA,GAAAA,SAAAA,KAAAA,GACnC;EAAA,MAAA,IAAfC,GAAG,GAAAC,KAAA,CAAAC,KAAA;EACZ,MAAA,IAAMC,OAAO,GAAG,IAAIC,KAAK,EAAE;EAC3B,MAAA,IAAMC,OAAO,GAAGL,GAAG,CAACM,YAAY,CAACX,QAAQ,CAAC;QAC1CQ,OAAO,CAACI,GAAG,GAAGF,OAAO;EACrBF,MAAAA,OAAO,CAACK,gBAAgB,CAAC,MAAM,EAAE,YAAM;EACrCR,QAAAA,GAAG,CAACO,GAAG,GAAGJ,OAAO,CAACI,GAAG;EACvB,OAAC,CAAC;EACFJ,MAAAA,OAAO,CAACK,gBAAgB,CAAC,OAAO,EAAE,YAAM;UACtCC,OAAO,CAACC,KAAK,CAA4BV,0BAAAA,GAAAA,GAAG,CAACO,GAAG,GAAA,QAAA,GAASF,OAAO,GAAA,GAAG,CAAC;EACtE,OAAC,CAAC;QACF,IAAIF,OAAO,CAACQ,QAAQ,EAAE;EACpBX,QAAAA,GAAG,CAACO,GAAG,GAAGJ,OAAO,CAACI,GAAG;EACvB;OACD;EAbD,IAAA,KAAA,IAAAK,SAAA,GAAAC,+BAAA,CAAkBjB,MAAM,CAAA,EAAAK,KAAA,EAAA,CAAA,CAAAA,KAAA,GAAAW,SAAA,EAAA,EAAAE,IAAA,GAAA;QAAAf,KAAA,EAAA;EAAA;KAczB;IAzDC,IAAI,CAACgB,QAAQ,GAAG,EAAE;IAClB,IAAI,CAACC,QAAQ,GAAG,EAAE;;EAElB;EACA;EACA;EACA;EACA,EAAA,IAAI,CAACC,KAAK,GAAG1B,OAAO,CAAC2B,cAAc,CAAC,MAAM,CAAC,GACvC3B,OAAO,CAAC,MAAM,CAAC,KAAK,IAAI,GACxB,IAAI;EAER,EAAA,IAAM4B,SAAS,GAAGtB,QAAQ,CAACuB,aAAa,CAAC,2BAA2B,CAAC;IACrE,IAAIC,YAAY,GAAIF,SAAS,IAAIG,SAAS,GAAI,EAAE,GAAGH,SAAS,CAACI,OAAO;EAEpE,EAAA,IAAIF,YAAY,CAACG,MAAM,GAAG,CAAC,EAAE;EAC3B,IAAA,IAAMC,OAAO,GAAGJ,YAAY,CAACK,KAAK,CAAC,GAAG,CAAC;EACvC,IAAA,KAAA,IAAAC,UAAA,GAAAd,+BAAA,CAAmBY,OAAO,CAAA,EAAAG,MAAA,EAAA,CAAA,CAAAA,MAAA,GAAAD,UAAA,EAAA,EAAAb,IAAA,GAAE;EAAA,MAAA,IAAjBe,IAAI,GAAAD,MAAA,CAAA1B,KAAA;QACb,IAAI,CAACa,QAAQ,CAACe,IAAI,CAACD,IAAI,CAACE,IAAI,EAAE,CAAC;EACjC;EACF,GAAC,MAAM;EACL,IAAA,IAAI,CAAChB,QAAQ,GAAG,CAAC,OAAO,EAAE,MAAM,CAAC;EACnC;IAAC,IAAAiB,MAAA,GAAAA,SAAAA,MAAAA,GAEmC;EAAA,IAAA,IAAzBtC,MAAM,GAAAuC,MAAA,CAAA/B,KAAA;MACf,IAAMgC,CAAC,GAAGC,UAAU,CAACC,UAAU,CAA2B1C,yBAAAA,GAAAA,MAAM,MAAG,CAAC;MACpE,IAAIwC,CAAC,CAACG,OAAO,EAAE;EACb7C,MAAAA,KAAI,CAACC,QAAQ,CAACC,MAAM,CAAC;EACvB;EACA,IAAA,IAAIF,KAAI,CAACyB,KAAK,KAAK,IAAI,EAAE;EACvBiB,MAAAA,CAAC,CAAC1B,gBAAgB,CAAC,QAAQ,EAAE,UAAA8B,CAAC,EAAI;UAChC,IAAIA,CAAC,CAACD,OAAO,EAAE;EACb5B,UAAAA,OAAO,CAAC8B,GAAG,CAAC,QAAQ,EAAED,CAAC,CAAC;EACxB9C,UAAAA,KAAI,CAACC,QAAQ,CAACC,MAAM,CAAC;EACvB;EACF,OAAC,CAAC;EACFF,MAAAA,KAAI,CAACwB,QAAQ,CAACc,IAAI,CAACI,CAAC,CAAC;EACvB;KACD;EAdD,EAAA,KAAA,IAAAM,UAAA,GAAA3B,+BAAA,CAAqB,IAAI,CAACE,QAAQ,CAAAkB,EAAAA,MAAA,EAAAA,CAAAA,CAAAA,MAAA,GAAAO,UAAA,IAAA1B,IAAA,GAAA;MAAAkB,MAAA,EAAA;EAAA;EAepC,CAAC;;ECtCH,SAASS,uBAAuBA,CAACC,EAAE,EAAE;EACnC,EAAA,IAAI7C,QAAQ,CAAC8C,UAAU,IAAI,SAAS,EAAE;EACpCD,IAAAA,EAAE,EAAE;EACN,GAAC,MAAM,IAAI7C,QAAQ,CAACW,gBAAgB,EAAE;EACpCX,IAAAA,QAAQ,CAACW,gBAAgB,CAAC,kBAAkB,EAAEkC,EAAE,CAAC;EACnD,GAAC,MAAM;EACL7C,IAAAA,QAAQ,CAAC+C,WAAW,CAAC,oBAAoB,EAAE,YAAW;QACpD,IAAI/C,QAAQ,CAAC8C,UAAU,IAAI,UAAU,EAAED,EAAE,EAAE;EAC7C,KAAC,CAAC;EACJ;EACF;EAEA,SAASG,iCAAiCA,GAAG;IAC3C,OAAO,IAAIvD,6BAA6B,EAAE;EAC5C;EAEAmD,uBAAuB,CAACI,iCAAiC,CAAC;;;;;;"}