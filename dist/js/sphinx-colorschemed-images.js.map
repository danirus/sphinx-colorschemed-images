{"version":3,"file":"sphinx-colorschemed-images.js","sources":["../../js/src/main.js","../../js/src/script.js"],"sourcesContent":["export class SphinxColorschemeImageHandler {\n  constructor(options={}) {\n    this._schemes = [];\n    this._mediaqs = [];\n\n    // If options are not given or if it is given with a key 'auto'\n    // and a boolean value true, then the instance created will add\n    // an event listener for changes on prefers-color-scheme to\n    // update images accordingly.\n    this._auto = options.hasOwnProperty('auto')\n      ? options['auto'] === true\n      : true;\n\n    const meta_prop = document.querySelector('meta[name=\"color-scheme\"]');\n    let meta_schemes = (meta_prop == undefined) ? \"\" : meta_prop.content;\n\n    if (meta_schemes.length > 0) {\n      const schemes = meta_schemes.split(\" \");\n      for (const item of schemes) {\n        this._schemes.push(item.trim());\n      }\n    } else {\n      this._schemes = ['light', 'dark'];\n    }\n\n    for (const scheme of this._schemes) {\n      const q = globalThis.matchMedia(`(prefers-color-scheme: ${scheme})`);\n      if (q.matches) {\n        this.activate(scheme);\n      }\n      if (this._auto === true) {\n        q.addEventListener('change', e => {\n          if (e.matches) {\n            this.activate(scheme);\n          }\n        });\n        this._mediaqs.push(q);\n      }\n    }\n  }\n\n  activate = (scheme) => {\n    const data_att = `data-alt-src-color-scheme-${scheme}`;\n    const images = document.querySelectorAll(`img[${data_att}]`);\n    for (const img of images) {\n      const new_img = new Image();\n      const new_src = img.getAttribute(data_att);\n      new_img.src = new_src;\n      new_img.addEventListener('load', () => {\n        img.src = new_img.src;\n      });\n      new_img.addEventListener('error', () => {\n        console.error(`Could not replace image ${img.src} with ${new_src}.`);\n      });\n      if (new_img.complete) {\n        img.src = new_img.src;\n      }\n\n      // Check whether the image is inside a <figure>.\n      const figure = img.closest('figure');\n      if (figure != undefined) {\n        const anchor = figure.querySelector('a');\n        if (anchor.getAttribute('href') !== new_src) {\n          anchor.href = new_src;\n        }\n      } else if (\n        (img.parentElement.tagName == \"A\")\n        && img.parentElement.getAttribute(\"href\") !== new_src\n      ) {\n        const parent = img.parentElement;\n        parent.href = img.getAttribute(data_att);\n        console.log(\"the new anchor's href:\", parent.href);\n      }\n    }\n  }\n}\n","import { SphinxColorschemeImageHandler } from \"./main\";\n\nfunction runWhenDOMContentLoaded(cb) {\n  if (document.readyState != 'loading') {\n    cb();\n  } else if (document.addEventListener) {\n    document.addEventListener('DOMContentLoaded', cb);\n  } else {\n    document.attachEvent('onreadystatechange', function() {\n      if (document.readyState == 'complete') cb();\n    });\n  }\n}\n\nfunction addSphinxColorschemedImageHandler() {\n  return new SphinxColorschemeImageHandler();\n}\n\nrunWhenDOMContentLoaded(addSphinxColorschemedImageHandler);\n"],"names":["SphinxColorschemeImageHandler","options","_this","activate","scheme","data_att","images","document","querySelectorAll","_loop","img","_step","value","new_img","Image","new_src","getAttribute","src","addEventListener","console","error","complete","figure","closest","undefined","anchor","querySelector","href","parentElement","tagName","parent","log","_iterator","_createForOfIteratorHelperLoose","done","_schemes","_mediaqs","_auto","hasOwnProperty","meta_prop","meta_schemes","content","length","schemes","split","_iterator2","_step2","item","push","trim","_loop2","_step3","q","globalThis","matchMedia","matches","e","_iterator3","runWhenDOMContentLoaded","cb","readyState","attachEvent","addSphinxColorschemedImageHandler"],"mappings":"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"}